<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book Donor Form</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f9f9f9;
      text-align: center;
    }
    video, canvas {
      max-width: 100%;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 16px;
      font-size: 1em;
      margin: 5px;
      cursor: pointer;
    }
    input[type="text"], input[type="email"] {
      width: 90%;
      max-width: 400px;
      padding: 10px;
      margin: 5px auto;
      display: block;
      font-size: 1em;
    }
    form {
      background: #fff;
      padding: 20px;
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <h1>üìö Donate a Book</h1>

  <p>Step 1: Capture the book cover</p>
  <video id="video" width="300" height="200" autoplay></video><br>
  <button id="capture">Capture</button>
  <canvas id="canvas" width="300" height="200" style="display: none;"></canvas>

  <p>Step 2: Extract Title from Cover</p>
  <button id="ocr">Extract Title</button>
  <p id="ocrStatus" style="margin-top: 8px; font-weight: bold; color: #555;"></p>

  <form action="https://docs.google.com/forms/d/e/1FAIpQLSfD6XxQaH-_VUY425YdmehytiYOLMDxVBKHvAr-z6d_x29C5w/formResponse" method="POST" target="_blank">
    <input type="text" name="entry.2005620554" placeholder="Book Title" required />
    <input type="text" name="entry.207535114" placeholder="Your Name" required />
    <input type="text" name="entry.1065046570" placeholder="School/Org (if any)" />
    <input type="text" name="entry.1166974658" placeholder="Phone Number" />
    <input type="email" name="entry.1045781291" placeholder="Email" />
    <input type="text" name="entry.839337160" placeholder="Author" />
    <input type="text" name="entry.1484740013" placeholder="Publisher" />
    <input type="text" name="entry.1852618071" placeholder="Edition (optional)" />
    <input type="text" name="entry.1624577213" placeholder="Number on back page (optional)" />
    <input type="text" name="entry.730415916" placeholder="Genre (e.g. Fiction, Kids, History)" />

    <button type="submit">Submit</button>
  </form>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
  <script>
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const context = canvas.getContext("2d");
    const captureBtn = document.getElementById("capture");
    const ocrBtn = document.getElementById("ocr");

    // Start video stream
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => { video.srcObject = stream; })
      .catch(err => console.error("Camera access denied:", err));

    // Capture photo
    captureBtn.onclick = () => {
      canvas.style.display = "block";
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
    };

    // OCR the image
    ocrBtn.onclick = async () => {
      const status = document.getElementById("ocrStatus");
      status.textContent = "üîç Extracting text... Please wait.";

      const blob = await new Promise(res => canvas.toBlob(res, "image/jpeg"));

      try {
        const { data: { text } } = await Tesseract.recognize(blob, "eng");
        const firstLine = text.split("\n").find(line => line.trim().length > 3);

        if (firstLine) {
          document.querySelector('input[name="entry.2005620554"]').value = firstLine.trim();
          status.textContent = "‚úÖ Title extracted!";
        } else {
          status.textContent = "‚ö†Ô∏è Could not detect text. Try again with a clearer photo.";
        }
      } catch (err) {
        console.error(err);
        status.textContent = "‚ùå OCR failed. Please retry.";
      }
    };
  </script>
</body>
</html>
